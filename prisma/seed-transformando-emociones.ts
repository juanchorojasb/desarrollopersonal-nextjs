   // prisma/seed-transformando-emociones.ts
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function seedTransformandoEmociones() {
  console.log('üé≠ Iniciando seed del curso "Transformando tus Emociones"...');

  try {
    // Verificar si ya existe
    const existeCurso = await prisma.course.findFirst({
      where: { title: 'Transformando tus Emociones: De la Autocr√≠tica a la Autocompasi√≥n' }
    });

    if (existeCurso) {
      console.log('‚ö†Ô∏è  El curso ya existe, saltando creaci√≥n...');
      return existeCurso;
    }

    // 1. CREAR EL CURSO PRINCIPAL
    const curso = await prisma.course.create({
      data: {
        title: 'Transformando tus Emociones: De la Autocr√≠tica a la Autocompasi√≥n',
        description: 'Un viaje transformador para aprender a gestionar tus emociones desde la neurociencia y la compasi√≥n. Descubre c√≥mo cambiar esa voz interior cr√≠tica por una voz cuidadora que te impulse hacia el crecimiento. Perfecto para quienes buscan desarrollar inteligencia emocional y bienestar interior.',
        shortDesc: 'Aprende a transformar la autocr√≠tica en autocompasi√≥n genuina y desarrolla una relaci√≥n saludable con tus emociones.',
        thumbnail: 'https://desarrollopersonaluno.b-cdn.net/thumbnails/transformando-emociones-thumb.jpg',
        level: 'beginner',
        category: 'inteligencia-emocional',
        tags: JSON.stringify([
          'autocr√≠tica', 
          'autocompasi√≥n', 
          'inteligencia-emocional',
          'gesti√≥n-emocional',
          'neurociencia',
          'bienestar'
        ]),
        price: 20000.0,
        currency: 'COP',
        status: 'published',
        featured: true,
        duration: 390, // 6h 30m en minutos
        studentsCount: 0,
        instructor: 'Equipo DesarrolloPersonal.uno',
      }
    });

    console.log('‚úÖ Curso creado:', curso.title);

    // 2. CREAR M√ìDULO PRINCIPAL
    const modulo = await prisma.module.create({
      data: {
        title: 'Transformando tus Emociones - Programa Completo',
        description: 'Serie completa de 8 sesiones para transformar tu relaci√≥n con las emociones, desde la autocr√≠tica destructiva hacia la autocompasi√≥n genuina.',
        position: 1,
        isRequired: true,
        duration: 390,
        courseId: curso.id,
      }
    });

    console.log('‚úÖ M√≥dulo creado:', modulo.title);

    // 3. CREAR LAS LECCIONES
    const lecciones = [
      {
        title: 'Sesi√≥n 1: Reconociendo tus Emociones',
        description: 'Aprende a identificar y nombrar tus emociones sin juzgarlas. El primer paso hacia la transformaci√≥n emocional.',
        content: `En esta sesi√≥n de bienvenida aprender√°s:

- Qu√© son realmente las emociones y por qu√© las experimentamos
- La diferencia entre emociones, sentimientos y estados de √°nimo
- C√≥mo identificar tus patrones emocionales autom√°ticos
- El poder de nombrar lo que sientes sin juzgarlo
- Ejercicio pr√°ctico: El mapa de tus emociones diarias

"No somos nuestras emociones, somos quienes las experimentamos. Esta distinci√≥n fundamental te dar√° el poder de observar sin ser arrastrado."

Al finalizar esta sesi√≥n tendr√°s claridad sobre tu paisaje emocional actual y las herramientas b√°sicas para la autoobservaci√≥n compasiva.`,
        position: 1,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-1-reconociendo-emociones.mp4',
        videoDuration: 2700, // 45 minutos
        isPreview: true, // Primera sesi√≥n gratuita
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 2: La Neurociencia de las Emociones',
        description: 'Comprende qu√© sucede en tu cerebro cuando experimentas emociones y c√≥mo puedes influir en estos procesos.',
        content: `Descubre el fascinante mundo de la neurociencia emocional:

- C√≥mo se forman las emociones en tu cerebro
- El papel de la am√≠gdala, corteza prefrontal y sistema l√≠mbico
- Por qu√© algunas emociones parecen "secuestrarnos"
- La neuroplasticidad: tu cerebro puede cambiar a cualquier edad
- T√©cnicas cient√≠ficas para regular emociones en tiempo real

"Tu cerebro no distingue entre una amenaza real y una amenaza imaginada. Comprender esto te da el poder de intervenir en tus respuestas emocionales."

Aprender√°s a usar la ciencia como herramienta de transformaci√≥n personal.`,
        position: 2,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-2-neurociencia-emociones.mp4',
        videoDuration: 3000, // 50 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 3: La Voz Interior que Hiere',
        description: 'Identifica esa voz cr√≠tica interna que sabotea tu bienestar y aprende c√≥mo se form√≥.',
        content: `Exploremos esa voz interior destructiva:

- C√≥mo se forma la voz cr√≠tica en la infancia y adolescencia
- Los diferentes tipos de autocr√≠tica y sus patrones
- Por qu√© la autocr√≠tica se vuelve adictiva para el cerebro
- El costo emocional y f√≠sico de la autocr√≠tica constante
- Ejercicio: Dialogando con tu cr√≠tico interno

"Esa voz que te dice 'no sirves para nada' no es tu verdadera voz. Es una voz aprendida que puede ser transformada."

Esta sesi√≥n es fundamental para comenzar a separarte de los pensamientos destructivos autom√°ticos.`,
        position: 3,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-3-voz-interior-hiere.mp4',
        videoDuration: 2800, // 47 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 4: Cultivando la Autocompasi√≥n',
        description: 'Aprende a desarrollar una voz interior compasiva que te cuide y te impulse hacia el crecimiento.',
        content: `Transforma tu di√°logo interno:

- Qu√© es la autocompasi√≥n y qu√© NO es (no es autocompasi√≥n vs autoestima)
- Los tres componentes de la autocompasi√≥n seg√∫n Kristin Neff
- C√≥mo hablarte como le hablar√≠as a un ser querido
- Ejercicios pr√°cticos de autocompasi√≥n
- La carta de autocompasi√≥n: escribi√©ndote con amor

"La autocompasi√≥n no es debilidad, es la fortaleza de tratarte con la misma bondad que mereces."

Desarrollar√°s una nueva forma de relacionarte contigo mismo que nutre en lugar de destruir.`,
        position: 4,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-4-cultivando-autocompasion.mp4',
        videoDuration: 3300, // 55 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 5: T√©cnicas de Regulaci√≥n Emocional',
        description: 'Herramientas pr√°cticas para gestionar emociones intensas en tiempo real.',
        content: `Domina las t√©cnicas m√°s efectivas:

- Respiraci√≥n consciente para calmar el sistema nervioso
- T√©cnica STOP: Detener patrones emocionales destructivos
- Visualizaci√≥n reparadora para emociones dif√≠ciles
- Mindfulness emocional: observar sin ser arrastrado
- Creando tu kit de emergencia emocional personalizado

"No se trata de no sentir emociones dif√≠ciles, se trata de no ser prisionero de ellas."

Tendr√°s un arsenal de herramientas para cualquier tormenta emocional.`,
        position: 5,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-5-tecnicas-regulacion.mp4',
        videoDuration: 2900, // 48 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 6: Emociones Dif√≠ciles como Maestras',
        description: 'Transforma tu relaci√≥n con emociones como la tristeza, ira y miedo, viendo su prop√≥sito evolutivo.',
        content: `Redefine tu relaci√≥n con emociones dif√≠ciles:

- El prop√≥sito evolutivo de cada emoci√≥n "negativa"
- Tristeza: La emoci√≥n de conexi√≥n y procesamiento
- Ira: Energ√≠a de cambio y establecimiento de l√≠mites
- Miedo: Protecci√≥n y preparaci√≥n para desaf√≠os
- Ansiedad: Se√±al de valores importantes en riesgo
- Pr√°ctica: Escuchando el mensaje de tus emociones

"Cada emoci√≥n dif√≠cil lleva un mensaje importante. Cuando aprendemos a escuchar, dejamos de luchar y comenzamos a crecer."

Transformar√°s emociones que antes evitabas en maestras de vida.`,
        position: 6,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-6-emociones-maestras.mp4',
        videoDuration: 3100, // 52 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 7: Construyendo Inteligencia Emocional',
        description: 'Desarrolla las cuatro competencias clave de la inteligencia emocional para una vida m√°s plena.',
        content: `Desarrolla las competencias emocionales esenciales:

- Autoconciencia emocional: Conocerte profundamente
- Autorregulaci√≥n: Gestionar tus respuestas emocionales
- Empat√≠a: Conectar genuinamente con otros
- Habilidades sociales: Navegar relaciones con sabidur√≠a emocional
- Creando tu plan personal de desarrollo emocional

"La inteligencia emocional no es un regalo, es una habilidad que se desarrolla con pr√°ctica consciente."

Integrar√°s todo lo aprendido en un sistema coherente de crecimiento emocional.`,
        position: 7,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-7-inteligencia-emocional.mp4',
        videoDuration: 3200, // 53 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      },
      {
        title: 'Sesi√≥n 8: Integraci√≥n y Mantenimiento',
        description: 'Integra todo lo aprendido y crea un plan de mantenimiento para sostener tu transformaci√≥n emocional.',
        content: `Cierre poderoso de tu transformaci√≥n:

- Revisi√≥n de tu viaje de transformaci√≥n emocional
- Creando rituales diarios de bienestar emocional
- Plan de mantenimiento a largo plazo
- Identificando y previniendo reca√≠das en autocr√≠tica
- Celebrando tu nueva relaci√≥n contigo mismo
- Pr√≥ximos pasos en tu crecimiento personal

"La transformaci√≥n no es un destino, es un camino. Has aprendido a caminar con compasi√≥n."

Tendr√°s un plan claro para mantener y profundizar tu crecimiento emocional.`,
        position: 8,
        type: 'video',
        videoUrl: 'https://desarrollopersonaluno.b-cdn.net/cursos/transformando-emociones/sesion-8-integracion.mp4',
        videoDuration: 2800, // 47 minutos
        isPreview: false,
        isRequired: true,
        moduleId: modulo.id,
      }
    ];

    // Crear todas las lecciones
    console.log('üìö Creando lecciones...');
    for (const leccionData of lecciones) {
      const leccion = await prisma.lesson.create({
        data: leccionData
      });
      console.log(`‚úÖ Lecci√≥n ${leccion.position}: ${leccion.title}`);
    }

    // 4. Verificar estructura completa
    const cursoCompleto = await prisma.course.findUnique({
      where: { id: curso.id },
      include: {
        modules: {
          include: {
            lessons: {
              orderBy: { position: 'asc' }
            }
          }
        }
      }
    });

    console.log('üéØ CURSO "TRANSFORMANDO TUS EMOCIONES" CREADO EXITOSAMENTE:');
    console.log(`üìñ T√≠tulo: ${cursoCompleto?.title}`);
    console.log(`üí∞ Precio: $${cursoCompleto?.price.toLocaleString()} ${cursoCompleto?.currency}`);
    console.log(`üìö M√≥dulos: ${cursoCompleto?.modules.length}`);
    console.log(`üé¨ Lecciones: ${cursoCompleto?.modules[0]?.lessons.length}`);
    console.log(`üÜì Lecci√≥n gratuita: ${cursoCompleto?.modules[0]?.lessons.find(l => l.isPreview)?.title}`);
    console.log(`‚è±Ô∏è  Duraci√≥n total: ${Math.floor((cursoCompleto?.duration || 0) / 60)} horas ${(cursoCompleto?.duration || 0) % 60} minutos`);
    
    return cursoCompleto;

  } catch (error) {
    console.error('‚ùå Error en seed:', error);
    throw error;
  }
}

// Funci√≥n principal para ejecutar
async function main() {
  console.log('üå± Iniciando seed de "Transformando tus Emociones"...');
  
  await seedTransformandoEmociones();
  
  console.log('‚úÖ Seed de "Transformando tus Emociones" completado exitosamente');
}

// Ejecutar solo si es llamado directamente
if (require.main === module) {
  main()
    .catch((e) => {
      console.error('‚ùå Error en main seed:', e);
      process.exit(1);
    })
    .finally(async () => {
      await prisma.$disconnect();
    });
}

export default seedTransformandoEmociones;
